(()=>{"use strict";const t=t=>document.querySelector(t),e=t("#image-input"),o=t("#image-vertical-offset"),a=t("#image-horizontal-offset"),n=t("body"),l=t("canvas"),r=t("#download-button"),i={textOffset:t("input#text-offset"),text:t("input#text"),textColor:t("input#text-color"),frameColor1:t("input#frame-color-1"),frameColor2:t("input#frame-color-2"),scale:t("#image-scale"),labelBackground:t("#label-background")},c=500;l.width=c,l.height=c;const s=l.getContext("2d");s.font="bold 60px Open Sans, sans-serif",s.textAlign="center",s.textBaseline="middle";const u=new Image;u.src="profile.jpg",u.onload=()=>{!function(){const t=100/(Math.min(u.height,u.width)/c);i.scale.value=t.toFixed(2),o.value=((u.height*t/100-c)/-2).toFixed(2),a.value=((u.width*t/100-c)/-2).toFixed(2)}(),p()};const d=t=>Math.round(255*t).toString(16),f=t=>/[\u0590-\u05FF]/.test(t);function p(){const t=i.scale.value/100,e=parseInt(i.labelBackground.value??0);s.drawImage(u,a.value,o.value,u.width*t,u.height*t),function(t){const e=s.createLinearGradient(0,c-t,c/2,c/2-t);e.addColorStop(0,i.frameColor1.value+d(1)),e.addColorStop(.15,i.frameColor1.value+d(1)),e.addColorStop(.8,i.frameColor2.value+d(1)),e.addColorStop(.9,i.frameColor2.value+d(.4)),e.addColorStop(.95,i.frameColor2.value+d(.1)),e.addColorStop(1,"rgba(0,0,0,0"),s.fillStyle=e,s.fillRect(0,c,c,-c)}(e),function(){const t=document.createElement("canvas");t.width=c,t.height=c;const e=t.getContext("2d"),n=i.scale.value/100;e.drawImage(u,a.value,o.value,u.width*n,u.height*n),e.globalCompositeOperation="destination-in",e.beginPath(),e.arc(250,250,170,0,2*Math.PI),e.closePath(),e.fill(),s.drawImage(t,0,0,500,500)}();const n=c/2;let l=i.text.value||"#EXAMPLE";f(l)&&(l=l.split("").reverse().join("")),function(t,e,o,a,n){t.fillStyle=i.textColor.value,t.save(),t.translate(o,a);const l=t.measureText(e).width,r=i.textOffset.value/100,c=(m*l+r)*Math.PI;t.rotate(c);const s=.86*n,u=Math.PI*-m;for(const[o,a]of e.split("").entries()){const e=u*t.measureText(a).width;o&&t.rotate(e),t.save(),t.translate(0,s),t.fillText(a,0,0),t.restore(),t.rotate(e)}t.restore()}(s,l,c/2,c/2,n)}const m=85e-5;const h=new FileReader;function g(t){o.value=parseInt(o.value)+t}function v(t){a.value=parseInt(a.value)+t}function w(t){i.scale.value=parseInt(i.scale.value)+t}function x(t){const e=new URLSearchParams(window.location.search);e.set(t.target.id,t.target.value),history.pushState(null,"","?"+e.toString()),p()}e.onchange=function(){const t=e.files[0];t&&(h.onload=()=>{u.src=h.result},h.readAsDataURL(t))},n.addEventListener("keydown",(t=>{"input"!==t.target.localName&&("ArrowUp"===t.code&&(t.metaKey||t.ctrlKey?w(1):g(-2),t.preventDefault()),"ArrowDown"===t.code&&(t.metaKey||t.ctrlKey?w(-1):g(2),t.preventDefault()),"ArrowLeft"===t.code&&v(-2),"ArrowRight"===t.code&&v(2),p())})),o.oninput=x,a.oninput=x,i.scale.oninput=x,i.labelBackground.oninput=x,i.frameColor1.oninput=x,i.frameColor2.oninput=x,i.text.oninput=x,i.textOffset.oninput=x,i.textColor.oninput=x,document.fonts.onloadingdone=p,r.onclick=function(){const t=document.createElement("a");t.href=l.toDataURL("image/jpg"),t.download="linked-profile-frame.jpg",document.body.appendChild(t),t.click(),document.body.removeChild(t)},function(){const e=new URLSearchParams(window.location.search);for(const[o,a]of e){const e=t(`input#${o}`);e&&(e.value=a)}}()})();